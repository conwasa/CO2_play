<!DOCTYPE html>
<head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
 <!-- http://t.co/dKP3o1e -->
 <meta name="HandheldFriendly" content="True">
 <meta name="MobileOptimized" content="320">

 <title>UK BN3 CO2 montioring station Real-time Outdoor CO2 ppm</title>
 <meta name="description" content="UK BN3 CO2 montioring station Real-time Outdoor CO2 ppm">
 
 <script src="handlebars-v4.0.11.js"></script>

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
 <script src="jquery.csv.min.js"></script>
 <script type="text/javascript" src="https://www.google.com/jsapi"></script>
 
<script type="text/javascript"> // load the visualisation API
  google.load('visualization', '1', { packages: ['corechart', 'controls'] });
</script>

<script type="text/javascript">

function drawVisualization() {


//   $.get("todays_readings.csv", function(csvString) {
   $.get("https://bypasscors.herokuapp.com/api/?url=https://storage.googleapis.com/uk_bn3_co2/todays_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_1 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_1',
         dataTable: data,
         options:{
            width: 450, height: 160,
            title: "Today's outdoor CO\u2082 levels [ppm] UK postcode BN3 7",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_1.draw();
   });

   $.get("yesterdays_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_3 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_3',
         dataTable: data,
         options:{
            width: 450, height: 160,
            title: "yesterday's readings",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_3.draw();
   });

   $.get("day_befores_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_2 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_2',
         dataTable: data,
         options:{
            width: 450, height: 160,
            title: "the day before",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_2.draw();
   });



   $.get("last_weeks_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_4 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_4',
         dataTable: data,
         options:{
            width: 450, height: 160,
            title: "last weeks' readings",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_4.draw();
   });

   $.get("last_months_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_5 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_5',
         dataTable: data,
         options:{
            width: 450, height: 160,
            title: "last months' readings",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_5.draw();
   });


   $.get("all_historic_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_6 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_6',
         dataTable: data,
         options:{
            width: 450, height: 160,
            title: "all historic readings",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_6.draw();
   });

   $.get("outages.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var table_1 = new google.visualization.ChartWrapper({
         chartType: 'Table',
         containerId: 'table_1',
         dataTable: data,
         options:{
            width: 300, height: 300,
            title: "outages",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 8},
         }
      });
      table_1.draw();
   });


}
google.setOnLoadCallback(drawVisualization)
</script>
<script type="text/x-handlebars-template">

</script>

<div id="chart_1"></div>

<div id="chart_3"></div>

<div id="chart_2"></div>

<div id="chart_4"></div>

<div id="chart_5"></div>

<div id="chart_6"></div>
<p>
<div id="table_1"></div>
<p>
<a href="all_readings.csv" download>Download data</a>
<h3>About</h3>
Readings are taken using an IR sensor with a light path of 1m. The sensor is in a ventilated weatherproof enclosure just above ground level. 
Its connected to logging software running on a Windows 7 laptop,
sampling every 10 minutes. A Python program processes the data to produce CSV files for the graphs and table, and Json
for statistics. The graphs and table are produced using Google's Visualisation API.
Data is stored in a Google storage bucket. 

<h3>Development Notes</h3>
Adding a dial gauge was abandoned as the online documentation is for an old version of the Google Charts that breaks the graphs.
Statistics are written to a Json file that was going to be processed using Handlebars. I've put that on hold to be able to move on.  
Actually I need that to show the data is live. Daily readings are padded with a value of 420 to 23:59 so it can be compared with the previous day.
<p>What's great is the data has structure. I think its driven by natural gas (methane) powered central heating. The street has  
<p>
I tried getting the Windows logging software to run on Linux, but didn't get past a problem where the logging software freezes after 
first reading is returned to the USB emulated COM port. I think the problem is the handshaking settings 7N1 8N1. 
<p>
A CORS problem accessing https://storage.googleapis.com/uk_bn3_co2/ from Github was bypassed using https://bypasscors.herokuapp.com/. 
<p>
The hardware: its a Senselife CAM desktop indoor air quality meter. I sold them for a while hoping schools would use them Pupils become drowsy
when CO\u2082 > 1500ppm. I've 5 or 6 of them left.
  