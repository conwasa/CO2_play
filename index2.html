<DOCTYPE html>
<head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
 <!-- http://t.co/dKP3o1e -->
 <meta name="HandheldFriendly" content="True">
 <meta name="MobileOptimized" content="320">
 <meta http-equiv="refresh" content="600">
 
 <!--
 CSV graphs based on Enrico Spinielliâ€™s Block 8d106a5cf9aa99734d43 
 http://bl.ocks.org/espinielli/8d106a5cf9aa99734d43
 -->
 <style>
Body { 	font-family: "Lucida Console", Monaco, monospace;
		font-size:small;
		}
.smaller {font-size:x-small;}
.page_orientation.smaller {font-size:x-small;}
.chart {width: 100%;
		background: white'
		margin-left: 0px}

.medium_size {font-size:small}

@media (min-width: 800px) {
		.smaller {	font-size:small;}
		.chart 	{	width: 100%;
					background: white;
					border: 5px solid white;}
		.medium_size {font-size:small}
		}
@media screen and (orientation: portrait) {div {background-color: white;}
											.page_orientation span { display: none;}
											.page_orientation:after {content: 'in Portrait display mode';
											}
											}
@media screen and (orientation: landscape) {div {background-color: white;}  
											.page_orientation span { display: none;}
											.page_orientation:after {content: 'in Landscape display mode';}
											.chart 	{	width: 98%;
														background: white;
														border: 5px solid white;}
											}


#myAnswer {display: none}
 </style>
 
 <title>UK BN3 CO2 montioring station Real-time Outdoor CO2 ppm</title>
 <meta name="description" content="UK BN3 CO2 montioring station Real-time Outdoor CO2 ppm">
 
<!--- <script src="handlebars-v4.0.11.js"></script> -->
 
<script src="handlebars.runtime-v4.0.12.js"></script>
 
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
 <script src="jquery.csv.min.js"></script>
 <script type="text/javascript" src="https://www.google.com/jsapi"></script>
 
<script type="text/javascript"> // load the visualisation API
  google.load('visualization', '1', { packages: ['corechart', 'controls'] });
</script>

<script>
function showAnswer() {
  document.getElementById("myAnswer").style.display = "block";
  document.getElementById("showButton").style.display = "none";
  
}
</script>
<script type="text/javascript">
function drawVisualization() {
 
 (function() { 
  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};
templates['location'] = template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data) {
    var stack1, helper;

  return ((stack1 = ((helper = (helper = helpers.site_location || (depth0 != null ? depth0.site_location : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === "function" ? helper.call(depth0 != null ? depth0 : (container.nullContext || {}),{"name":"site_location","hash":{},"data":data}) : helper))) != null ? stack1 : "");
},"useData":true});
})();
(function() {
  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};
templates['download_description'] = template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data) {
    var stack1, helper;

  return "  "
    + ((stack1 = ((helper = (helper = helpers.dl_file_text || (depth0 != null ? depth0.dl_file_text : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === "function" ? helper.call(depth0 != null ? depth0 : (container.nullContext || {}),{"name":"dl_file_text","hash":{},"data":data}) : helper))) != null ? stack1 : "");
},"useData":true});
})();
(function() {
  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};
templates['latest_co2_readings'] = template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data) {
    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3="function";

  return ((stack1 = ((helper = (helper = helpers.line1 || (depth0 != null ? depth0.line1 : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{"name":"line1","hash":{},"data":data}) : helper))) != null ? stack1 : "")
    + "<br>"
    + ((stack1 = ((helper = (helper = helpers.line2 || (depth0 != null ? depth0.line2 : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{"name":"line2","hash":{},"data":data}) : helper))) != null ? stack1 : "")
    + "<br>"
    + ((stack1 = ((helper = (helper = helpers.line3 || (depth0 != null ? depth0.line3 : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{"name":"line3","hash":{},"data":data}) : helper))) != null ? stack1 : "")
    + "<br>";
},"useData":true});
})();
	
   $.get("https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/todays_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_1 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_1',
         dataTable: data,
         options:{
            width: 'goose', height: 160,
            title: "Today's indoor testbed  CO\u2082 levels [ppm]",
			legend: 'left',
			hAxis: {slantedText: false},
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_1.draw();
   });

   $.get("https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/yesterdays_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_3 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_3',
         dataTable: data,
         options:{
            width: '100%', height: 160,
            title: "yesterday's readings",
			legend: 'left',
            hAxis: {slantedText: false},
			titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_3.draw();
   });

   $.get("https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/day_befores_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_2 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_2',
         dataTable: data,
         options:{
            width: '100%', height: 160,
            title: "the day before's",
			hAxis: {slantedText: false},
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_2.draw();
   });

   $.get("https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/last_weeks_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_4 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_4',
         dataTable: data,
         options:{
            width: '100%', height: 160,
            title: "last weeks' readings",
			hAxis: {slantedText: false},
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_4.draw();
   });

   $.get("https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/week_before_lasts_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_7 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_7',
         dataTable: data,
         options:{
            width: '100%', height: 160,
            title: "the week before's readings",
			hAxis: {slantedText: false},
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_7.draw();
   });


   $.get("https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/last_months_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional 
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_5 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_5',
         dataTable: data,
         options:{
            width: '100%', height: 160,
            title: "last months' readings",
			hAxis: {slantedText: false},
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_5.draw();
   });


   $.get("https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/all_historic_readings.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var chart_6 = new google.visualization.ChartWrapper({
         chartType: 'LineChart',
         containerId: 'chart_6',
         dataTable: data,
         options:{
            width: '100%', height: 160,
            hAxis: {slantedText: false},
			title: "all readings since 16 November 2019",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 11},
         }
      });
      chart_6.draw();
   });

   $.get("https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/outages.csv", function(csvString) {
      // transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvString, {onParseValue: $.csv.hooks.castToScalar});
      // this new DataTable object holds all the data
      var data = new google.visualization.arrayToDataTable(arrayData);
      var table_1 = new google.visualization.ChartWrapper({
         chartType: 'Table',
         containerId: 'table_1',
         dataTable: data,
         options:{
            width: 300, height: 300,
            title: "data outages",
			legend: 'left',
            titleTextStyle : {color: 'grey', fontSize: 8},
         }
      });
      table_1.draw();
   });

	var ourRequest = new XMLHttpRequest();
	var URL = 'https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/stats.json';
  ourRequest.open('GET', 'https://cors.x7.workers.dev/https://storage.googleapis.com/uk_bn3_co2_test/stats.json');
  ourRequest.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      // Action to be performed when the document is read;
	  console.log('ready state good');
 	  data1 = JSON.parse(ourRequest.responseText); /* made into a global variable for debugging */
	  var H1_location_html = Handlebars.templates['location'](data1)

	  document.getElementById("heading_H1").innerHTML += H1_location_html  
	  document.getElementById("sensor_location").innerHTML += H1_location_html  

	  var latest_co2_readings_html = Handlebars.templates['latest_co2_readings'](data1)
	  document.getElementById("page_start").innerHTML += latest_co2_readings_html  

	  var download_description_html = Handlebars.templates['download_description'](data1)
	  document.getElementById("dl_description").innerHTML += download_description_html  

    } else {
	   console.log('readyState=' + this.readyState + ' status=' +this.status);
    }
  };
  ourRequest.onerror = function () {
    console.log('connection error');
  }
  ourRequest.send();

}

google.setOnLoadCallback(drawVisualization)

</script>
</head>
<body>
<H1  class="medium_size" id="heading_H1">Testbed CO<sub>2</sub> levels </H1>

<div id="page_start" class="smaller"></div>
<div class="page_orientation smaller"><span></span></div>
<p>
<div id="chart_1" class="chart"></div>

<div id="chart_3" class="chart"></div>

<div id="chart_2" class="chart"></div>

<div id="chart_4" class="chart"></div>

<div id="chart_7" class="chart"></div>

<div id="chart_5" class="chart"></div>

<div id="chart_6" class="chart"></div>
<p>
<div id="dl_description"><a href="https://storage.googleapis.com/uk_bn3_co2_test/all_readings.csv">Download data</a></div>

<h3>About</h3>

<p>This is a development test system. The live outdoor page is here: <href a="https://conwasa.github.io/CO2_play/index.html">https://conwasa.github.io/CO2_play/index.html</a>

<p>
<div id="table_1"></div>

</body>
  
